(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["vote"],{"29c8":function(t,e,r){"use strict";r.r(e);var s=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("Main",{class:[t.isTestNet?"":"zkpvote"],attrs:{className:"zkp-vote"}},[t.isShow?[1===t.status&&t.topicDetail.topic?[s("Share",{attrs:{topic:t.topicDetail.topic}})]:t._e(),t.topicDetail.topic?[t.isSelf&&0===t.status?[s("Authority",{attrs:{authorityKey:t.authorityKey,name:t.topicDetail.topic},on:{open:t.showActiveTheVote}})]:t._e(),0===t.status&&this.isSelf||t.status>0?[s("Detail",{attrs:{status:t.status,topicDetail:t.topicDetail,proposedBy:t.proposedBy,authPubKey:t.authPubKey,endTime:t.endTime}})]:t._e(),t.voteResult&&t.status>0?[s("Encrypted",{attrs:{status:t.status,voteResult:t.voteResult,txID:t.txID,authPubKey:t.authPubKey,choices:t.topicDetail.choices}})]:t._e(),t.status>0?[s("AllVotes",{attrs:{status:t.status}})]:t._e(),t.isSelf&&0===t.status?[s("ActiveTheVote",{attrs:{visible:t.isShowActiveTheVote,loading:t.isLoading,printData:t.printData},on:{close:t.hideActiveTheVote}})]:t._e(),s("a",{staticClass:"faucet-link",attrs:{href:"https://faucet.vecha.in/",target:"_blank"}})]:t._e()]:t._e(),t.isTestNet&&t.isShowNotFound?[s("NotFound")]:t._e(),t.isPreLoading&&!t.isShowNotFound?[s("div",{directives:[{name:"loading",rawName:"v-loading",value:!0,expression:"true"}],staticClass:"loading",attrs:{"element-loading-background":"rgba(255, 255, 255, 0)"}})]:t._e(),t.isTestNet?t._e():[s("div",{staticClass:"environment"},[s("div",{staticClass:"content"},[s("h2",{staticClass:"title"},[t._v("WRONG ENVIRONMENT")]),s("p",{staticClass:"desc"},[t._v("ZKPVOTE runs in VeChainThor Testnet")])])])],s("Dialog",{attrs:{center:"",visible:t.isShowSignin,"close-on-click-modal":!1,width:"410px","show-close":!1}},[s("img",{staticClass:"signin-image",attrs:{src:r("46df")}}),s("p",{staticClass:"signin-text"},[t._v("Please sign in first")]),s("Button",{attrs:{colorType:"dark",size:"sm",width:"180px"},on:{click:t.login}},[t._v(" Sign in ")])],1)],2)},n=[],i=(r("99af"),r("7db0"),r("fb6a"),r("a7cc"),r("450d"),r("df33")),a=r.n(i),o=(r("96cf"),r("1da1")),c=r("d4ec"),u=r("bee2"),h=r("262e"),p=r("2caf"),l=r("9ab4"),b=r("60a3"),f=r("3691"),v=r("3617"),g=r("d257"),d=r("5322"),y=r("79f6"),x=r("5126"),m=r("4b3b"),w=r("4bb5"),k=r("32b1"),D=r("399f"),O=r.n(D),j=function(t){Object(h["a"])(r,t);var e=Object(p["a"])(r);function r(){var t;return Object(c["a"])(this,r),t=e.apply(this,arguments),t.isTestNet=!0,t.authorityKey="",t.isShowSignin=!1,t.isShowActiveTheVote=!1,t.status=-1,t.endTime=-1,t.voteResult="",t.txID="",t.authPubKey="",t.topicDetail={topic:"",choices:[]},t.isSelf=!1,t.proposedBy="0x",t.isLoading=!1,t.printData=[],t}return Object(u["a"])(r,[{key:"created",value:function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Object(g["d"])();case 3:if(t.sent){t.next=6;break}return Object(g["e"])(),t.abrupt("return",!1);case 6:return t.next=8,Object(g["h"])();case 8:if(t.sent){t.next=10;break}throw Error("Connection Error");case 10:return t.next=12,Object(g["i"])();case 12:if(t.sent){t.next=15;break}throw this.isTestNet=!1,Error("ZKPVote only runs in Testnet");case 15:if(!this.voteIDStatus){t.next=31;break}return t.next=18,this.checkVoteIDexist();case 18:if(e=t.sent,e){t.next=21;break}return t.abrupt("return",!1);case 21:return this.proposedBy=e,this.isSelf=this.signer===e,t.next=25,this.getVoteStatus();case 25:return t.next=27,this.getVoteDetail(e);case 27:if(this.signer||this.isShowNotFound){t.next=31;break}return t.next=30,this.login();case 30:return t.abrupt("return",t.sent);case 31:return t.abrupt("return",!1);case 34:if(t.prev=34,t.t0=t["catch"](0),"user cancelled"!==(t.t0.message||t.t0)){t.next=39;break}return this.isShowSignin=!0,t.abrupt("return",!1);case 39:return"VoteID does not exist"===(t.t0.message||t.t0)&&(this.proposedBy=""),t.abrupt("return",this.$notify({type:"error",title:"Error",message:"".concat(t.t0.message||t.t0)}));case 41:case"end":return t.stop()}}),t,this,[[0,34]])})));function e(){return t.apply(this,arguments)}return e}()},{key:"login",value:function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,y["a"].login();case 2:e=t.sent,e&&(sessionStorage.setItem("signer",e),this.setSigner(e),this.reload());case 4:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"checkVoteIDexist",value:function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,y["a"].checkVoteIDexist(this.voteID);case 2:if(e=t.sent,e){t.next=5;break}return t.abrupt("return",void 0);case 5:return t.abrupt("return",e);case 6:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"getVoteDetail",value:function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(e){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(d["a"])(this.config.ipfsConfig).files.read("/".concat(e,"/").concat(this.voteID));case 2:return r=t.sent,t.next=5,Object(g["a"])(r);case 5:this.topicDetail=t.sent;case 6:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()},{key:"getVoteStatus",value:function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(){var e,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,y["a"].proposalStatus(this.voteID);case 3:return e=t.sent,void 0!==e&&(this.status=e),t.next=7,y["a"].castEndTime(this.voteID);case 7:r=t.sent,void 0!==r&&(this.endTime=r),1===this.status&&1e3*this.endTime<(new Date).getTime()&&(this.status=2),t.t0=this.status,t.next=0===t.t0?13:15;break;case 13:return this.isSelf&&(this.authorityKey=Object(m["d"])(Object(m["c"])())),t.abrupt("break",24);case 15:return t.next=17,y["a"].getAuthPubKey(this.voteID);case 17:if(this.authPubKey=t.sent,!this.signer){t.next=23;break}return t.next=21,this.getVoteResult();case 21:return t.next=23,this.getCastBinaryBallot(0);case 23:return t.abrupt("break",24);case 24:t.next=29;break;case 26:t.prev=26,t.t1=t["catch"](0),this.$notify({type:"error",title:"Error",message:"".concat(t.t1.message||t.t1)});case 29:case"end":return t.stop()}}),t,this,[[0,26]])})));function e(){return t.apply(this,arguments)}return e}()},{key:"getVoteResult",value:function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(){var e;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,y["a"].getBallot(this.voteID,this.signer);case 2:e=t.sent,e&&(this.voteResult=e);case 4:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"getCastBinaryBallot",value:function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(e){var r,s,n=this;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,y["a"].getCastBinaryBallot({id:this.voteID,fromAddress:this.signer,from:e,limit:256});case 2:if(r=t.sent,!r||!r.length){t.next=11;break}if(s=r.find((function(t){return t.signer===n.signer})),!s){t.next=9;break}this.txID=s.txID,t.next=11;break;case 9:return t.next=11,this.getCastBinaryBallot(e+10);case 11:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()},{key:"hideActiveTheVote",value:function(t){this.printData=[],this.isShowActiveTheVote=t,this.reload()}},{key:"showActiveTheVote",value:function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(e){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(g["d"])();case 2:if(t.sent){t.next=5;break}return Object(g["e"])(),t.abrupt("return",!1);case 5:return t.next=7,Object(g["h"])();case 7:if(t.sent){t.next=9;break}throw Error("Connection Error");case 9:return t.next=11,Object(g["i"])();case 11:if(t.sent){t.next=13;break}throw Error("ZKPVote only runs in Testnet");case 13:if(!this.isLoading){t.next=15;break}return t.abrupt("return",!1);case 15:return this.isLoading=!0,this.isShowActiveTheVote=e,this.printData.push({tag:"website",desc:"Get private key"}),t.next=20,Object(g["f"])(300);case 20:return this.printData.push({tag:"website",desc:"Perform Elliptic Curve calculations"}),t.next=23,Object(g["f"])(300);case 23:return this.printData.push({tag:"website",desc:"Compute public key"}),t.next=26,Object(g["f"])(300);case 26:return t.next=28,this.setPublicKey();case 28:return t.abrupt("return",!1);case 29:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()},{key:"setPublicKey",value:function(){var t=Object(o["a"])(regeneratorRuntime.mark((function t(){var e,r,s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,e=new O.a(this.authorityKey.slice(2),"hex"),r=k["b"].mul(e),this.printData.push({tag:"contract",desc:"Set public key"}),t.next=6,Object(g["f"])(300);case 6:return t.next=8,y["a"].setAuthPubKey(this.signer,[this.voteID,Object(m["d"])(r.getX()),r.getY().isEven()?"0x02":"0x03"]);case 8:return s=t.sent,this.isLoading=!1,s&&this.printData.push({tag:"success",desc:"Active successfully!"}),t.abrupt("return",void 0);case 14:return t.prev=14,t.t0=t["catch"](0),this.printData=[],this.isLoading=!1,this.isShowActiveTheVote=!1,t.abrupt("return",this.$notify({type:"error",title:"Error",message:"".concat(t.t0)}));case 20:case"end":return t.stop()}}),t,this,[[0,14]])})));function e(){return t.apply(this,arguments)}return e}()},{key:"voteID",get:function(){return this.$route.params.voteID}},{key:"isPreLoading",get:function(){return this.proposedBy&&"0x"!==this.proposedBy&&this.isTestNet&&!this.topicDetail.topic}},{key:"isShow",get:function(){return this.isTestNet&&-1!==this.status&&this.topicDetail.topic}},{key:"isShowNotFound",get:function(){if(-1===this.status)return!this.voteIDStatus||!this.proposedBy;if(this.isTestNet){if(this.status>0)return!1;if(0===this.status&&this.isSelf)return!1;if(!this.voteIDStatus)return!0;if(0===this.status&&(!this.signer||!this.isSelf))return!0;if(!this.proposedBy)return!0}return!1}},{key:"voteIDStatus",get:function(){return 66===this.voteID.length&&x["utils"].isHex(this.voteID)}}]),r}(b["g"]);Object(l["a"])([Object(w["b"])("signer")],j.prototype,"signer",void 0),Object(l["a"])([Object(w["b"])("config")],j.prototype,"config",void 0),Object(l["a"])([Object(w["a"])("setSigner")],j.prototype,"setSigner",void 0),Object(l["a"])([Object(b["c"])("reload")],j.prototype,"reload",void 0),j=Object(l["a"])([Object(b["a"])({components:{Avatar:f["a"],Button:f["b"],Main:v["h"],Authority:v["c"],Detail:v["e"],ActiveTheVote:v["a"],CodeFormat:v["d"],Share:v["j"],Encrypted:v["f"],AllVotes:v["b"],NotFound:v["i"],Dialog:a.a}})],j);var S=j,T=S,V=(r("d485a"),r("0c7c")),I=Object(V["a"])(T,s,n,!1,null,"48a4a420",null);e["default"]=I.exports},"46df":function(t,e,r){t.exports=r.p+"img/signin.2c36c16a.png"},"84b6":function(t,e,r){},d485a:function(t,e,r){"use strict";r("84b6")}}]);